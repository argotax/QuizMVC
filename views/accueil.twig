{% extends 'layout.twig' %}

{% block css %}

  <link rel="stylesheet" href="/stylesheet/accueil.css">

{% endblock %}

{% block body %}
  <div class="block-main" id="blockMain">

    <a style="color:white;position:absolute" href="/disconnect">D√©connexion</a>

    <div class="block-header">
      <div class="login px-2">
        Bonjour {% if login is defined %}{{login}}{% endif %} !
      </div>
      <div class="container-i profile px-3"><i class="fa fa-user fa-2x" aria-hidden="true"></i></div>
      <div class="container-i left px-4" onclick="displayFriend()"><i class="fa fa-caret-left fa-2x" id="leftArrow" aria-hidden="true"></i></div>
    </div>

    <div class="block-info">
      <div class="alert alert-success friend-confirmed" role="alert">Ami ajout√© !</div>
      <div class="alert alert-danger friend-canceled" role="alert">Demande refus√©e !</div>
    </div>

    <h1 class="title">BroQuiz</h1>

    <div class="block-button">
      <button type="button" class="btn btn-dark w-25 mb-3 p-3">Jouer</button>
      <button type="button" class="btn btn-dark w-25 mb-3 p-3">Classement</button>
      <button type="button" class="btn btn-dark w-25 mb-3 p-3">Historique</button>
      <a href="/question" class="btn btn-dark w-25 mb-3 p-3"><span>Ajouter une question</span></a>
    </div>

  </div>

  <div class="block-friend" id="blockFriend">

    <div class="block-header">
      <div class="friend-box p-1 friend-connected">
        <i class="fa fa-user fa-2x" aria-hidden="true"></i>
        <div class="friend-count mx-2">5</div>
      </div>
      <div class="friend-box p-1 friend-absent">
        <i class="fa fa-user fa-2x" aria-hidden="true"></i>
        <div class="friend-count mx-2">5</div>
      </div>
      <div class="friend-box p-1 friend-disconnected">
        <i class="fa fa-user fa-2x" aria-hidden="true"></i>
        <div class="friend-count mx-2">5</div>
      </div>
    </div>

    <div class="friend-list-wrapper" id="friend-list">

      <div class="input-group my-3 w-75">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1">üîç</span>
        </div>
        <input type="text" class="form-control instant-search" id="friendLogin" name="friendLogin" placeholder="Chercher un ami" aria-label="Username" aria-describedby="basic-addon1">
        <div class="input-group-append">
          <span class="input-group-text add-friend-button" onclick="friendRequest()">‚ûï</span>
        </div>
      </div>

      <div class="scroll friend-list-block">
        <ul class="list">
          {% for friend in friends %}
            <li class="w-100 list-item list-item" id="{{friend[0]}}"><div class="name">{{ friend[3]|capitalize }}
            {% if friend[2] == 5 %}
              <i class="fas fa-circle"></i>
            {% else %}
              <div class="block-icon" id="{{friend[0]}}-icon"><i class="fas fa-check fa-lg confirm" onclick="confirmRequest({{friend[0]}})"></i><i class="fas fa-times fa-lg cancel" onclick="cancelRequest({{friend[0]}})"></i></div>
            {% endif %}
            </div></li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

{% endblock %}

{% block script%}

  <script src= "/vendors/socket.io/socket.io.js"></script>
  <script src="/vendors/list/list.min.js" charset="utf-8"></script>
  <script type="text/javascript">
    var position = 0;

    var socket = io.connect('http://10.2.4.18:3000');

    function friendRequest() {
      socket.emit('friend-request', { user: '{{id}}', friend: $("#friendLogin").val() } );
      $('#friendLogin').val('');
    }

    function displayFriend() {
      if (position == 0) {
        $("#blockFriend").css("left","70%");
        $("#blockMain").css("width","70%");
        $("#leftArrow").css("transform","rotate(180deg)");
        position = 1;
      } else {
        $("#blockFriend").css("left","100%");
        $("#blockMain").css("width","100%");
        $("#leftArrow").css("transform","rotate(0deg)");
        position = 0;
      }

    }

    function confirmRequest(friend) {
      socket.emit('confirm-request', { friend: friend } );
    }

    function cancelRequest(friend) {
      socket.emit('cancel-request', { friend: friend } );
    }

    socket.on('friend-confirmed', function (data) {
      $("#"+data.data+"-icon").html('<i class="fas fa-circle"></i>');
      $('.friend-confirmed').css('display','block');
      setTimeout(function() { $(".friend-confirmed").css('display','none'); }, 5000);
    });

    socket.on('friend-canceled', function (data) {
      $("#"+data.data).css('display','none');
      $('.friend-canceled').css('display','block');
      setTimeout(function() { $(".friend-canceled").css('display','none'); }, 5000);
    });

    var list = new List('friend-list', {
      valueNames: ['name']
    });
  </script>

{% endblock %}
